{"version":3,"sources":["form-process.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"form-process.min.js","sourcesContent":["/**\r\n * Created by Ariel on 05/11/2016.\r\n */\r\n$(document).ready(function()\r\n{\r\n    $.ajaxSetup({\r\n        headers: {\r\n            'X-CSRF-Token': $('meta[name=\"_token\"]').attr('content')\r\n        }\r\n    });\r\n\r\n    $('.modal_error_wrapper').hide();\r\n});\r\n\r\n$(document).on('submit','.modal_form',function(e)\r\n{\r\n    e.preventDefault();\r\n\r\n    var form = $(this);\r\n    var formData = form.serialize();\r\n    var url = form.attr('action');\r\n    var method = form.attr('method');\r\n\r\n    var saveLabel = form.find('span.save-label');\r\n    saveLabel.html('');\r\n    saveLabel.addClass('fa fa-spin fa-spinner');\r\n    form.find('.modal-form-submit-button').attr('disabled','true');\r\n    form.find('.modal-cancel-button').attr('disabled','true');\r\n\r\n    $.ajax({\r\n\r\n        type: method,\r\n        data: formData,\r\n        url: url,\r\n\r\n        error: function(data)\r\n        {\r\n\r\n            var errors = data.responseJSON;\r\n            var process = form.data('process');\r\n\r\n            console.log(errors);\r\n            form.find('.this_errors').html('');\r\n            form.find('.modal_error_wrapper').show();\r\n            form.find('.this_errors').show();\r\n\r\n            var errorsHtml = '<ul>';\r\n            $.each( errors, function( key, value )\r\n            {\r\n                if(value!='')\r\n                {\r\n                    errorsHtml += '<li> <span class=\"glyphicon glyphicon-remove-sign\" aria-hidden=\"true\"></span> ' + value[0] + '</li>'; //showing only the first error.\r\n                }\r\n\r\n                $('label[for=\"'+key+'\"]').addClass('error_label error');\r\n                $('#'+key).addClass('error_field error');\r\n            });\r\n\r\n            errorsHtml += '</ul>';\r\n\r\n            console.log(errorsHtml);\r\n\r\n            form.find('.this_errors').append(errorsHtml);\r\n            form.find('.modal-form-submit-button').removeAttr('disabled');\r\n            form.find('.modal-cancel-button').removeAttr('disabled');\r\n\r\n            saveLabel.html('Save');\r\n            saveLabel.removeClass('fa fa-spin fa-spinner');\r\n\r\n        },\r\n        success: function(data)\r\n        {\r\n            //form.find('input[type=\"submit\"]').prop('disabled',true);\r\n            form.find('.error').each(function(){\r\n                $(this).removeClass('error');\r\n                $(this).removeClass('error_field');\r\n                $(this).removeClass('error_label');\r\n            });\r\n\r\n            $('.modal_error_wrapper').hide();\r\n\r\n            //reload the datatable\r\n            var table = $(form.data('datatable')).DataTable();\r\n            var successModal = $('#success_modal');\r\n            var successModalMessage = $('#success_modal_message');\r\n\r\n            switch(data.process)\r\n            {\r\n                case 'update_user':\r\n\r\n                    //update the row in the datatable\r\n                    var updatedItem = data.data;\r\n                    var id = data.id;\r\n\r\n                    //row base ID\r\n                    var rowBaseID = '#member-'+id+'-';\r\n\r\n                    //get all the data from row\r\n                    $(rowBaseID+'first_name').html(updatedItem.first_name);\r\n                    $(rowBaseID+'middle_name').html(updatedItem.middle_name);\r\n                    $(rowBaseID+'last_name').html(updatedItem.last_name);\r\n                    $(rowBaseID+'address').html(updatedItem.address);\r\n                    $(rowBaseID+'email').html(updatedItem.email);\r\n                    $(rowBaseID+'birth_date').html(updatedItem.birth_date);\r\n\r\n                    form.find('.modal-form-submit-button').removeAttr('disabled');\r\n                    form.find('.modal-cancel-button').removeAttr('disabled');\r\n                    saveLabel.removeClass('fa fa-spin fa-spinner');\r\n                    saveLabel.html('Save Changes');\r\n\r\n                    //close the modal and open the success modal\r\n                    $(form.data('parentmodal')).modal('hide');\r\n\r\n                    console.log(form.data('success'));\r\n                    successModalMessage.html(form.data('success'));\r\n                    successModal.modal('show');\r\n\r\n                    break;\r\n\r\n                case 'update_book':\r\n\r\n                    //update the row in the datatable\r\n                    var updatedItem = data.data;\r\n                    var id = data.id;\r\n\r\n                    //row base ID\r\n                    var rowBaseID = '#book-'+id+'-';\r\n\r\n                    //get all the data from row\r\n                    $(rowBaseID+'title').html(updatedItem.title);\r\n\r\n                    //get the display value if the author_id\r\n                    var author =  $(\"#author_id option:selected\").text();\r\n                    var authorTD = $(rowBaseID+'author');\r\n                    authorTD.html(author);\r\n                    authorTD.data('author',data.author_id);\r\n\r\n                    $(rowBaseID+'isbn').html(updatedItem.isbn);\r\n                    $(rowBaseID+'quantity').html(updatedItem.quantity);\r\n                    $(rowBaseID+'overdue_fine').html(updatedItem.overdue_fine);\r\n                    $(rowBaseID+'shelf_location').html(updatedItem.shelf_location);\r\n\r\n                    form.find('.modal-form-submit-button').removeAttr('disabled');\r\n                    form.find('.modal-cancel-button').removeAttr('disabled');\r\n                    saveLabel.removeClass('fa fa-spin fa-spinner');\r\n                    saveLabel.html('Save Changes');\r\n\r\n                    //close the modal and open the success modal\r\n                    $(form.data('parentmodal')).modal('hide');\r\n\r\n                    console.log(form.data('success'));\r\n                    successModalMessage.html(form.data('success'));\r\n                    successModal.modal('show');\r\n\r\n                    break;\r\n\r\n                case 'update_author':\r\n\r\n                    //update the row in the datatable\r\n                    var updatedItem = data.data;\r\n                    var id = data.id;\r\n\r\n                    //row base ID\r\n                    var rowBaseID = '#author-'+id+'-';\r\n\r\n                    //get all the data from row\r\n                    $(rowBaseID+'first_name').html(updatedItem.first_name);\r\n                    $(rowBaseID+'middle_name').html(updatedItem.middle_name);\r\n                    $(rowBaseID+'last_name').html(updatedItem.last_name);\r\n                    $(rowBaseID+'description').html(updatedItem.description);\r\n                    $(rowBaseID+'birth_date').html(updatedItem.birth_date);\r\n\r\n                    form.find('.modal-form-submit-button').removeAttr('disabled');\r\n                    form.find('.modal-cancel-button').removeAttr('disabled');\r\n                    saveLabel.removeClass('fa fa-spin fa-spinner');\r\n                    saveLabel.html('Save Changes');\r\n\r\n                    //close the modal and open the success modal\r\n                    $(form.data('parentmodal')).modal('hide');\r\n\r\n                    console.log(form.data('success'));\r\n                    successModalMessage.html(form.data('success'));\r\n                    successModal.modal('show');\r\n\r\n                    break;\r\n\r\n                default :\r\n                    table.ajax.reload(function(){\r\n\r\n                        form.find('.modal-form-submit-button').removeAttr('disabled');\r\n                        form.find('.modal-cancel-button').removeAttr('disabled');\r\n                        saveLabel.removeClass('fa fa-spin fa-spinner');\r\n                        saveLabel.html('Save');\r\n\r\n                        //close the modal and open the success modal\r\n                        $(form.data('parentmodal')).modal('hide');\r\n\r\n                        console.log(form.data('success'));\r\n                        successModalMessage.html(form.data('success'));\r\n                        successModal.modal('show');\r\n\r\n                    },false);\r\n            }\r\n        }\r\n    });\r\n\r\n});\r\n\r\n"]}