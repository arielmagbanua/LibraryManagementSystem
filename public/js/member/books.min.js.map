{"version":3,"sources":["books.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"books.min.js","sourcesContent":["$(document).ready(function()\r\n{\r\n    $.ajaxSetup({\r\n        headers: {\r\n            'X-CSRF-Token': $('meta[name=\"_token\"]').attr('content')\r\n        }\r\n    });\r\n\r\n    var date = new Date();\r\n    date.setDate(date.getDate()-1);\r\n\r\n    $('#borrow_start_date').datepicker({\r\n        format: \"yyyy-mm-dd\",\r\n        clearBtn: true,\r\n        autoclose: true,\r\n        todayHighlight: true,\r\n        startDate: date\r\n    });\r\n\r\n    var baseURL = $('#baseURL').html();\r\n    var booksListURL = baseURL+'/serverSide/borrowBooksList';\r\n\r\n    $('#books_datatable').DataTable({\r\n        'processing': true,\r\n        'serverSide': true,\r\n        'order': [[ 0, \"desc\" ]],\r\n        'ajax': {\r\n            url: booksListURL,\r\n            type: 'get',\r\n            error: function() {}\r\n        },\r\n        'columns':[\r\n            {'data':'title'},\r\n            {'data':'author'},\r\n            {'data':'isbn'},\r\n            {'data':'quantity'},\r\n            {'data':'overdue_fine'},\r\n            {'data':'shelf_location'},\r\n            {'data':'actions','orderable': false}\r\n        ]\r\n    });\r\n\r\n    $('#borrow_book_modal').on('show.bs.modal', function (e) {\r\n\r\n        if(e.namespace === 'bs.modal')\r\n        {\r\n            $('.modal-title').html('Borrow');\r\n            $('#borrow_start_date').val('');\r\n\r\n            var invoker = $(e.relatedTarget);\r\n            var invokerAction = invoker.data('action');\r\n\r\n            if(invokerAction=='borrow_book')\r\n            {\r\n                var bookID = invoker.data('id');\r\n                console.log(bookID);\r\n                //load the id to the hidden field of the modal for deletion\r\n                $('#book_id_to_borrow').val(bookID);\r\n\r\n                //set the yes button to defaults\r\n                var borrowButton = $('#borrow_button');\r\n                var borrowLabel = borrowButton.find('span.borrow-label');\r\n                borrowLabel.html('Yes');\r\n                borrowLabel.removeClass('fa fa-spin fa-spinner');\r\n                borrowButton.removeAttr('disabled');\r\n                borrowButton.show();\r\n\r\n                $('#borrow_cancel_button').html('Cancel');\r\n\r\n                //set the body message to default\r\n                $('#borrow_modal_message').html('Borrow a copy of this book?');\r\n            }\r\n        }\r\n\r\n    });\r\n\r\n    $('#borrow_button').click(function()\r\n    {\r\n        //get the member id\r\n        var bookID = $('#book_id_to_borrow').val();\r\n        console.log(bookID);\r\n        var startDate = $('#borrow_start_date').val();\r\n        console.log(startDate);\r\n\r\n        //do not let the user proceed if there is not start date\r\n        if(startDate=='' || startDate==undefined)\r\n        {\r\n            $('#borrow_modal_message').html('Please provide the borrow start date!');\r\n            return;\r\n        }\r\n\r\n        var borrowButton = $(this);\r\n        var borrowCancelButton = $('#borrow_cancel_button');\r\n\r\n        //modify the delete label to show spinner load\r\n        var borrowLabel = borrowButton.find('span.borrow-label');\r\n        borrowLabel.html('');\r\n        borrowLabel.addClass('fa fa-spin fa-spinner');\r\n        borrowButton.prop('disabled',true);\r\n        borrowCancelButton.prop('disabled',true);\r\n\r\n        var borrowURL = baseURL + '/member/book/'+bookID+'/borrow/'+startDate;\r\n        console.log(borrowURL);\r\n\r\n        $.ajax({\r\n            type: 'post',\r\n            url: borrowURL,\r\n            success: function(data)\r\n            {\r\n                //remove the record in datatable\r\n                var table = $('#books_datatable').DataTable();\r\n\r\n                table.ajax.reload(function(){\r\n\r\n                    if(data.status=='fail')\r\n                    {\r\n                        $('.modal-title').html('Ooppps!');\r\n                        $('#borrow_modal_message').html(data.message);\r\n                        borrowCancelButton.html('Ok, Understand');\r\n                    }\r\n                    else\r\n                    {\r\n                        $('.modal-title').html('Borrow');\r\n                        $('#borrow_modal_message').html(data.message);\r\n                        borrowCancelButton.html('Close');\r\n                    }\r\n\r\n                    //Change the message of modal and hide the delete button\r\n                    borrowButton.hide();\r\n                    borrowCancelButton.removeAttr('disabled');\r\n\r\n                },false);\r\n\r\n            }\r\n        });\r\n\r\n    });\r\n\r\n});"]}