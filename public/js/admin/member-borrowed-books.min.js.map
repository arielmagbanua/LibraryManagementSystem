{"version":3,"sources":["member-borrowed-books.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"member-borrowed-books.min.js","sourcesContent":["$(document).ready(function()\r\n{\r\n    $.ajaxSetup({\r\n        headers: {\r\n            'X-CSRF-Token': $('meta[name=\"_token\"]').attr('content')\r\n        }\r\n    });\r\n\r\n    var baseURL = $('#baseURL').html();\r\n    var booksListURL = baseURL+'/serverSide/memberBorrowedBooksList';\r\n\r\n    $('#pending_borrowed_books_datatable').DataTable({\r\n        'processing': true,\r\n        'serverSide': true,\r\n        'order': [[ 0, \"desc\" ]],\r\n        'ajax': {\r\n            url: booksListURL,\r\n            type: 'get',\r\n            error: function() {}\r\n        },\r\n        'columns':[\r\n            {'data':'title'},\r\n            {'data':'author_name'},\r\n            {'data':'isbn'},\r\n            {'data':'borrow_start_date'},\r\n            {'data':'fine'},\r\n            {'data':'borrower'},\r\n            {'data':'borrower_email'},\r\n            {'data':'actions','orderable': false}\r\n        ]\r\n    });\r\n\r\n    $('#request_modal').on('show.bs.modal', function (e) {\r\n\r\n        var invoker = $(e.relatedTarget);\r\n        var invokerAction = invoker.data('action');\r\n\r\n        var requestID = invoker.data('id');\r\n        var memberName = invoker.data('member');\r\n        console.log(requestID);\r\n        console.log(memberName);\r\n\r\n        var yesButton = $('#yes_button');\r\n        var yesLabel = yesButton.find('span.yes-label');\r\n\r\n        if(invokerAction=='return_book')\r\n        {\r\n            $('.modal-title').html('Return Book');\r\n\r\n            yesButton.data('action','return_book');\r\n\r\n            //load the id to the hidden field of the modal for deletion\r\n            $('#request_id_to_return').val(requestID);\r\n\r\n            //set the yes button to defaults\r\n            yesButton.removeClass('btn-default');\r\n            yesButton.removeClass('btn-danger');\r\n            yesButton.addClass('btn-success');\r\n            yesButton.removeAttr('disabled');\r\n            yesButton.show();\r\n\r\n            yesLabel.html('Yes');\r\n            yesLabel.removeClass('fa fa-spin fa-spinner');\r\n\r\n            $('#cancel_button').html('Cancel');\r\n\r\n            //set the body message to default\r\n            $('#request_modal_message').html('Are you sure that '+memberName+' already returned this book?');\r\n        }\r\n        else if(invokerAction=='return_book_pending')\r\n        {\r\n            $('.modal-title').html('Return Book as Pending Request.');\r\n\r\n            yesButton.data('action','return_book_pending');\r\n\r\n            //load the id to the hidden field of the modal for deletion\r\n            $('#request_id_to_return').val(requestID);\r\n\r\n            //set the yes button to defaults\r\n            yesButton.removeClass('btn-default');\r\n            yesButton.removeClass('btn-danger');\r\n            yesButton.addClass('btn-primary');\r\n            yesButton.removeAttr('disabled');\r\n            yesButton.show();\r\n\r\n            yesLabel.html('Yes');\r\n            yesLabel.removeClass('fa fa-spin fa-spinner');\r\n\r\n            $('#cancel_button').html('Cancel');\r\n\r\n            //set the body message to default\r\n            $('#request_modal_message').html('Are you sure you want to return this borrowed book as pending request?');\r\n        }\r\n\r\n    });\r\n\r\n    $('#yes_button').click(function()\r\n    {\r\n        //get the action of the button\r\n        var yesButton = $(this);\r\n        var yesAction = yesButton.data('action');\r\n        var yesLabel = yesButton.find('span.yes-label');\r\n        yesLabel.html('');\r\n        yesLabel.addClass('fa fa-spin fa-spinner');\r\n\r\n        var cancelButton = $('#cancel_button');\r\n\r\n        //get the request id\r\n        var requestID = $('#request_id_to_return').val();\r\n        console.log(requestID);\r\n        console.log(yesAction);\r\n\r\n        //modify the delete label to show spinner load\r\n        yesButton.prop('disabled',true);\r\n        cancelButton.prop('disabled',true);\r\n\r\n        var actionURL = '';\r\n\r\n        if(yesAction==='return_book')\r\n        {\r\n            actionURL = baseURL + '/admin/book/'+requestID+'/book_returned';\r\n        }\r\n        else if(yesAction==='return_book_pending')\r\n        {\r\n            actionURL = baseURL + '/admin/book/'+requestID+'/return_book_pending';\r\n        }\r\n\r\n        console.log(actionURL);\r\n\r\n        $.ajax({\r\n            type: 'post',\r\n            url: actionURL,\r\n            success: function(data)\r\n            {\r\n                //remove the record in datatable\r\n                var table = $('#pending_borrowed_books_datatable').DataTable();\r\n\r\n                table.ajax.reload(function(){\r\n\r\n                    if(data.status=='fail')\r\n                    {\r\n                        $('.modal-title').html('Ooppps!');\r\n                        $('#request_modal_message').html(data.message);\r\n                        cancelButton.html('Ok, I Understand');\r\n                    }\r\n                    else\r\n                    {\r\n                        $('.modal-title').html('Success');\r\n                        $('#request_modal_message').html(data.message);\r\n                        cancelButton.html('Close');\r\n                    }\r\n\r\n                    //Change the message of modal and hide the delete button\r\n                    yesButton.hide();\r\n                    cancelButton.removeAttr('disabled');\r\n\r\n                },false);\r\n\r\n            }\r\n        });\r\n\r\n    });\r\n\r\n});\r\n"]}